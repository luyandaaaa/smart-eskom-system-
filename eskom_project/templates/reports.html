<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Illegal Connection Monitor</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>

    <style>
        :root {
            --primary-color: #0d6efd;
            --secondary-color: #f8f9fa;
            --warning-color: #ff4444;
            --success-color: #27ae60;
            --info-color: #3498db;
            --text-primary: #2c3e50;
            --text-secondary: #7f8c8d;
            --sidebar-width: 250px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            display: flex;
            background-color: #ecf0f1;
            color: var(--text-primary);
        }

        .sidebar {
            width: 250px;
            height: 100vh;
            background: white;
            padding: 20px;
            position: fixed;
            box-shadow: 2px 0 5px rgba(0,0,0,0.1);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 30px;
        }

        .logo img {
            width: 32px;
            height: 32px;
        }

        .logo span {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--text-dark);
        }

        .nav-item {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            margin: 5px 0;
            text-decoration: none;
            color: var(--text-muted);
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .nav-item i {
            margin-right: 10px;
        }

        .nav-item.active {
            background: var( --primary-color);
            color: white;
        }

        .nav-item:hover:not(.active) {
            background: var(--primary-color);
        }

        main {
            flex: 1;
            margin-left: var(--sidebar-width);
            padding: 20px;
        }

        .stats-container {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .stat-card h3 {
            color: var(--text-secondary);
            margin-bottom: 10px;
        }

        .stat-card .value {
            font-size: 24px;
            font-weight: bold;
            color: var(--primary-color);
        }

        .reports-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }

        .report-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .report-card h3 {
            color: var(--text-primary);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .map-container {
            height: 400px;
            background: #f5f6fa;
            border-radius: 8px;
            margin-top: 15px;
            position: relative;
        }

        .chart-container {
            height: 300px;
            margin-top: 15px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        th {
            background: var(--secondary-color);
            color: var(--text-primary);
        }

        .risk-high {
            color: var(--warning-color);
            font-weight: bold;
        }

        .risk-medium {
            color: #f39c12;
            font-weight: bold;
        }

        .risk-low {
            color: var(--success-color);
            font-weight: bold;
        }

        .map-legend {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background: white;
            padding: 10px;
            border-radius: 5px;
            z-index: 1000;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }

        .legend-item {
            display: flex;
            align-items: center;
            margin: 5px 0;
            font-size: 12px;
        }

        .legend-color {
            width: 15px;
            height: 15px;
            margin-right: 8px;
            border-radius: 50%;
        }

        @media (max-width: 1200px) {
            .stats-container {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .reports-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .sidebar {
                width: 70px;
            }

            .sidebar .logo span,
            .sidebar ul li a span {
                display: none;
            }

            main {
                margin-left: 70px;
            }

            .stats-container {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <nav class="sidebar">
        <div class="logo">
            <img src="images/eskom_logo2.jpg" alt="Eskom Logo">
            <span>Eskom Monitor</span>
        </div>
        <a href="index.html" class="nav-item">
            <i class="fas fa-home"></i>
            Dashboard
        </a>
        <a href="alerts.html" class="nav-item">
            <i class="fas fa-bell"></i>
            Alerts
        </a>
        <a href="map.html" class="nav-item">
            <i class="fas fa-map-marker-alt"></i>
            Map View
        </a>
        <a href="reports.html" class="nav-item active">
            <i class="fas fa-chart-line"></i>
            Reports
        </a>
        <a href="technicians.html" class="nav-item">
            <i class="fas fa-users"></i>
            Technicians
        </a>
    </nav>

    <main>
        <div class="stats-container">
            <div class="stat-card">
                <h3>Total Detected Cases</h3>
                <div class="value">8,130</div>
                <small>+15% from last month</small>
            </div>
            <div class="stat-card">
                <h3>Estimated Revenue Loss</h3>
                <div class="value">R39M</div>
                <small>Year to date</small>
            </div>
            <div class="stat-card">
                <h3>High Risk Areas</h3>
                <div class="value">23</div>
                <small>5 new this month</small>
            </div>
            <div class="stat-card">
                <h3>Recovery Rate</h3>
                <div class="value">62%</div>
                <small>+5% improvement</small>
            </div>
        </div>

        <div class="reports-grid">
            <div class="report-card">
                <h3><i class="fas fa-map-marker-alt"></i> High Risk Areas</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Area</th>
                            <th>Cases</th>
                            <th>Loss (R)</th>
                            <th>Risk Level</th>
                        </tr>
                    </thead>
                    <tbody id="riskAreasTable">
                        <!-- Populated by JavaScript -->
                    </tbody>
                </table>
            </div>

            <div class="report-card">
                <h3><i class="fas fa-chart-pie"></i> Detection Types</h3>
                <div class="chart-container">
                    <canvas id="detectionTypesChart"></canvas>
                </div>
            </div>

            <div class="report-card">
                <h3><i class="fas fa-chart-line"></i> Monthly Trends</h3>
                <div class="chart-container">
                    <canvas id="monthlyTrendsChart"></canvas>
                </div>
            </div>

            <div class="report-card">
                <h3><i class="fas fa-map"></i> Hotspot Map</h3>
                <div class="map-container" id="hotspotMap">
                    <!-- Map will be initialized here -->
                </div>
            </div>
        </div>
    </main>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.0/chart.min.js"></script>
    <script>
        // Data
        const riskAreas = [
            { area: 'Soweto', cases: 2450, loss: 12500000, risk: 'High' },
            { area: 'Tembisa', cases: 1850, loss: 8900000, risk: 'High' },
            { area: 'Alexandra', cases: 1650, loss: 7800000, risk: 'High' },
            { area: 'Diepsloot', cases: 1200, loss: 5600000, risk: 'Medium' },
            { area: 'Orange Farm', cases: 980, loss: 4200000, risk: 'Medium' }
        ];

        const detectionTypes = {
            labels: ['Direct Tapping', 'Meter Bypass', 'Modified Meters', 'Billing Fraud'],
            data: [45, 30, 15, 10],
            colors: ['#ff6b6b', '#ffd93d', '#6c5ce7', '#a8e6cf']
        };

        const monthlyData = {
            labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
            detected: [580, 620, 750, 890, 820, 950],
            resolved: [320, 350, 420, 480, 520, 580]
        };

        // Populate Risk Areas Table
        function populateRiskTable() {
            const tbody = document.getElementById('riskAreasTable');
            riskAreas.forEach(area => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${area.area}</td>
                    <td>${area.cases.toLocaleString()}</td>
                    <td>R${(area.loss / 1000000).toFixed(1)}M</td>
                    <td class="risk-${area.risk.toLowerCase()}">${area.risk}</td>
                `;
                tbody.appendChild(row);
            });
        }

        // Create Detection Types Chart
        function createDetectionTypesChart() {
            const ctx = document.getElementById('detectionTypesChart').getContext('2d');
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: detectionTypes.labels,
                    datasets: [{
                        data: detectionTypes.data,
                        backgroundColor: detectionTypes.colors,
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right'
                        }
                    }
                }
            });
        }

        // Create Monthly Trends Chart
        function createMonthlyTrendsChart() {
            const ctx = document.getElementById('monthlyTrendsChart').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: monthlyData.labels,
                    datasets: [
                        {
                            label: 'Detected Cases',
                            data: monthlyData.detected,
                            borderColor: '#ff6b6b',
                            tension: 0.4,
                            fill: false
                        },
                        {
                            label: 'Resolved Cases',
                            data: monthlyData.resolved,
                            borderColor: '#27ae60',
                            tension: 0.4,
                            fill: false
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        // Initialize Hotspot Map
        function initializeHotspotMap() {
            const hotspotLocations = [
                // Gauteng
                { lat: -26.2041, lng: 28.0473, intensity: 'high', name: 'Johannesburg' },
                { lat: -25.7479, lng: 28.2293, intensity: 'high', name: 'Pretoria' },
                { lat: -26.3059, lng: 28.1444, intensity: 'high', name: 'Germiston' },
                { lat: -26.1542, lng: 28.3536, intensity: 'medium', name: 'Benoni' },
                // KwaZulu-Natal
                { lat: -29.8587, lng: 31.0218, intensity: 'high', name: 'Durban' },
                { lat: -29.6006, lng: 30.3794, intensity: 'medium', name: 'Pietermaritzburg' },
                { lat: -28.7282, lng: 32.0373, intensity: 'medium', name: 'Richards Bay' },
                // Western Cape
                { lat: -33.9249, lng: 18.4241, intensity: 'high', name: 'Cape Town' },
                { lat: -33.7139, lng: 18.9822, intensity: 'medium', name: 'Paarl' },
                // Eastern Cape
                { lat: -33.0292, lng: 27.8546, intensity: 'high', name: 'East London' },
                { lat: -33.9608, lng: 25.6022, intensity: 'high', name: 'Port Elizabeth' },
                // Free State
                { lat: -29.0852, lng: 26.1596, intensity: 'medium', name: 'Bloemfontein' },
                // Mpumalanga
                { lat: -25.4753, lng: 30.9694, intensity: 'medium', name: 'Nelspruit' },
                // Limpopo
                { lat: -23.9045, lng: 29.4688, intensity: 'medium', name: 'Polokwane' },
                // North West
                { lat: -25.8560, lng: 25.6403, intensity: 'medium', name: 'Rustenburg' }
            ];

            const map = L.map('hotspotMap').setView([-29.0, 25.0], 6);

            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: 'Â© OpenStreetMap contributors'
            }).addTo(map);

            const getMarkerColor = (intensity) => {
                return intensity === 'high' ? '#ff4444' : '#ffa500';
            };

            const getCircleRadius = (intensity) => {
                return intensity === 'high' ? 30000 : 20000; // meters
            };

            hotspotLocations.forEach(location => {
                // Add circle for the hotspot area
                L.circle([location.lat, location.lng], {
                    color: getMarkerColor(location.intensity),
                    fillColor: getMarkerColor(location.intensity),
                    fillOpacity: 0.3,
                    radius: getCircleRadius(location.intensity)
                }).addTo(map);

                // Add marker with popup
                L.marker([location.lat, location.lng])
                    .addTo(map)
                    .bindPopup(`
                        <strong>${location.name}</strong><br>
                        Risk Level: ${location.intensity.charAt(0).toUpperCase() + location.intensity.slice(1)}<br>
                        Click for details
                    `);
            });

            // Add legend
            const legend = L.control({ position: 'bottomright' });
            legend.onAdd = function(map) {
                const div = L.DomUtil.create('div', 'map-legend');
                div.innerHTML = `
                    <h4>Hotspot Intensity</h4>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #ff4444"></div>
                        <span>High Risk Area</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #ffa500"></div>
                        <span>Medium Risk Area</span>
                    </div>
                `;
                return div;
            };
            legend.addTo(map);
        }

        // Update the DOMContentLoaded event listener
        document.addEventListener('DOMContentLoaded', function() {
            populateRiskTable();
            createDetectionTypesChart();
            createMonthlyTrendsChart();
            initializeHotspotMap();
        });
    </script>
</body>
</html>